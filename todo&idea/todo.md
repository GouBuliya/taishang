<todo>
1.å¢åŠ é‡è¯•æœºåˆ¶ï¼Œå¢å¼ºå¥å£®æ€§ï¼Œå½“äº¤æ˜“ç³»ç»ŸæŠ¥é”™æ—¶ï¼Œå°è¯•è®©å¤§æ¨¡å‹é‡æ–°ç”Ÿæˆ1éï¼Œå¦‚æœä»ç„¶æŠ¥é”™ï¼Œå‘é€ç”µå­é‚®ä»¶ï¼Œç„¶åç­‰å¾…ä¸‹æ¬¡äº¤æ˜“ã€‚
2.åˆ†æè¿™ä¸ªç³»ç»Ÿçš„åˆ†æ”¯å›¾ï¼Œå¢åŠ æ¨¡å—åŒ–ï¼Œå¢åŠ å¯æ‰©å±•æ€§ï¼Œå¢åŠ å¯ç»´æŠ¤æ€§ã€‚
3.å¢åŠ RAGçŸ¥è¯†åº“ã€‚
4.é€æ­¥å®Œæˆæ€ç»´å¯¼å›¾çš„å†…å®¹ï¼Œ![alt text](74897eab5a5fec8f6c276b15f76399a9.jpg)
5.ç³»ç»Ÿä¸­ç•™å‡ºåˆ¤åˆ«å½¢æ¨¡å‹çš„ä½ç½®ï¼Œå¹¶ç•™å‡ºæ¥å£ï¼Œæ–¹ä¾¿åç»­æ·»åŠ åˆ¤åˆ«å½¢æ¨¡å‹ã€‚ï¼ˆåç»­æˆ‘ä¼šå°†æ¨¡å‹çš„ç»“æœå½“ä½œå› å­ï¼Œæ·»åŠ åˆ°ç³»ç»Ÿä¸­ï¼‰
6.å¦å¤–ç³»ç»Ÿåå«"å¤ªç†µ"
</todo>
<!-- <prompt>
ä½ éœ€è¦æ‰«ææ•´ä¸ªé¡¹ç›®ï¼Œåˆ—å‡ºæ€ç»´å¯¼å›¾Aï¼Œç„¶åæ ¹æ®æ€ç»´å¯¼å›¾Aç»“åˆ4.çš„æ€ç»´å¯¼å›¾ï¼Œåˆ—å‡ºæ€ç»´å¯¼å›¾Bï¼Œ
ç„¶ååœ¨todo.mdåæ·»åŠ çš„todo.mdåæ·»åŠ æ€ç»´å¯¼å›¾Bçš„å›¾ç‰‡ï¼Œå¹¶æ›´æ–°todo.mdæ–‡ä»¶ã€‚
ç„¶åæ ¹æ®<todo>çš„å†…å®¹åˆ—å‡ºä¸€ä¸ªå¯è¡Œæ€§æ–¹æ¡ˆï¼ˆè¶Šè¯¦ç»†è¶Šå¥½ï¼‰ï¼Œå¹¶æ›´æ–°todo.mdæ–‡ä»¶ã€‚ï¼ˆæ›´æ–°ä¸ºåœ¨åŸæœ‰å†…å®¹ä¸Šæ·»åŠ ï¼‰,



<!-- ---

## ğŸ§  æ€ç»´å¯¼å›¾B - å¤ªç†µç³»ç»Ÿæµç¨‹ä¼˜åŒ–æ¶æ„

åŸºäºç³»ç»Ÿè¿è¡Œæ—¥å¿—åˆ†æå’Œtodoéœ€æ±‚ï¼Œé‡æ–°è®¾è®¡çš„æµç¨‹åŒ–æ¶æ„å›¾å·²ç”Ÿæˆï¼ˆMermaidå›¾è¡¨ï¼‰

### ğŸ¯ æ ¸å¿ƒæµç¨‹æ”¹è¿›ç‚¹

1. **ç³»ç»Ÿå¯åŠ¨æµç¨‹ä¼˜åŒ–** - ç¯å¢ƒæ£€æŸ¥â†’é…ç½®åŠ è½½â†’æœåŠ¡å¯åŠ¨çš„æ ‡å‡†åŒ–æµç¨‹
2. **æ•°æ®æ”¶é›†æµç¨‹å¢å¼º** - é¢„å¤„ç†â†’é‡‡é›†â†’æ•´åˆçš„ä¸‰é˜¶æ®µæ•°æ®å¤„ç†
3. **AIå†³ç­–æµç¨‹æ”¹è¿›** - æ•°æ®é¢„å¤„ç†â†’æ¨¡å‹æ¨ç†â†’ç»“æœèåˆçš„æ™ºèƒ½å†³ç­–é“¾
4. **äº¤æ˜“æ‰§è¡Œæµç¨‹å®Œå–„** - è®¢å•é¢„æ£€â†’äº¤æ˜“æ‰§è¡Œâ†’ç»“æœè®°å½•çš„å®‰å…¨äº¤æ˜“æµç¨‹
5. **å¾ªç¯ç›‘æ§æµç¨‹** - æ—¶é—´è§¦å‘â†’å¼‚å¸¸ç›‘æ§â†’é€šçŸ¥æœºåˆ¶çš„æŒç»­ç›‘æ§ä½“ç³»
6. **å®¹é”™é‡è¯•æœºåˆ¶** - AIé‡è¯•ã€äº¤æ˜“é‡è¯•ã€æ•°æ®é‡è¯•çš„å¤šå±‚ä¿éšœ --> -->

--- -->

<prompt>
å…ƒæŒ‡ä»¤ï¼Œä½ å¿…é¡»å®Œæ•´çš„æ‰§è¡Œæ‰€æœ‰æç¤ºè¯çš„ä»»åŠ¡ï¼Œä¸è¦é—æ¼ä»»ä½•ä¸€æ­¥ã€‚


## ğŸ“‹ è¯¦ç»†å¯è¡Œæ€§å®æ–½æ–¹æ¡ˆ
### ğŸ”„ 1. é‡è¯•æœºåˆ¶å’Œå¥å£®æ€§å¢å¼º

#### 1.0 Chromeå¯åŠ¨é—®é¢˜ä¿®å¤ï¼ˆç´§æ€¥ï¼‰
**é—®é¢˜åˆ†æï¼š**
ä»ç³»ç»Ÿæ—¥å¿—å¯è§Chromeæµè§ˆå™¨åˆå§‹åŒ–æ—¶å‡ºç°`KeyboardInterrupt`é”™è¯¯ï¼Œå¯¼è‡´`data_server.py`å¯åŠ¨å¤±è´¥ã€‚

**ç«‹å³ä¿®å¤æ–¹æ¡ˆï¼š**
- [ ] æ·»åŠ Chromeå¯åŠ¨è¶…æ—¶æ£€æµ‹ï¼ˆå½“å‰æ— é™ç­‰å¾…ï¼‰
- [ ] å®ç°Chromeå¯åŠ¨å¤±è´¥åçš„é‡è¯•æœºåˆ¶
- [ ] ä¼˜åŒ–Chromeé…ç½®å‚æ•°ï¼Œå‡å°‘å¯åŠ¨æ—¶é—´
- [ ] æ·»åŠ æ— å¤´æµè§ˆå™¨å¤‡ç”¨æ–¹æ¡ˆ

**æŠ€æœ¯å®ç°ï¼š**
```python
def initialize_browser_with_retry(max_retries=3, timeout=30):
    for attempt in range(max_retries):
        try:
            signal.alarm(timeout)  # è®¾ç½®è¶…æ—¶
            driver = uc.Chrome(options=chrome_options, headless=True)
            signal.alarm(0)  # å–æ¶ˆè¶…æ—¶
            return driver
        except Exception as e:
            logger.warning(f"Chromeå¯åŠ¨å¤±è´¥ (ç¬¬{attempt+1}æ¬¡): {e}")
            if attempt < max_retries - 1:
                time.sleep(2 ** attempt)  # æŒ‡æ•°é€€é¿
            else:
                # å¯ç”¨å¤‡ç”¨æµè§ˆå™¨æ–¹æ¡ˆ
                return init_firefox_driver()
```

**ä¼˜å…ˆçº§ï¼š** ğŸ”´ ç´§æ€¥
**é¢„ä¼°å·¥æœŸï¼š** 1-2å¤©

#### 1.1 AIæ¨¡å‹é‡è¯•æœºåˆ¶
**å®æ–½æ­¥éª¤ï¼š**
- [ ] åˆ›å»º `src/core/retry_manager.py` æ¨¡å—
- [ ] åœ¨ `gemini_Controller.py` ä¸­é›†æˆé‡è¯•é€»è¾‘
- [ ] å®ç°æŒ‡æ•°é€€é¿ç®—æ³•ï¼ˆ1s, 2s, 4s, 8sï¼‰
- [ ] æ·»åŠ APIå¯†é’¥è½®æ¢æœºåˆ¶

**æŠ€æœ¯ç»†èŠ‚ï¼š**
```python
class RetryManager:
    def __init__(self, max_retries=3, backoff_factor=2):
        self.max_retries = max_retries
        self.backoff_factor = backoff_factor
    
    def retry_with_backoff(self, func, *args, **kwargs):
        # å®ç°é‡è¯•é€»è¾‘
        pass
```

#### 1.2 é‚®ä»¶é€šçŸ¥ç³»ç»Ÿ
**å®æ–½æ­¥éª¤ï¼š**
- [ ] åˆ›å»º `src/notification/email_notifier.py`
- [ ] é›†æˆSMTPé…ç½®åˆ° `config.json`
- [ ] å®ç°å¼‚å¸¸çº§åˆ«åˆ†ç±»ï¼ˆè­¦å‘Š/é”™è¯¯/ä¸¥é‡ï¼‰
- [ ] æ·»åŠ é‚®ä»¶æ¨¡æ¿ç³»ç»Ÿ

**ä¼˜å…ˆçº§ï¼š** ğŸ”´ é«˜
**é¢„ä¼°å·¥æœŸï¼š** 3-5å¤©

### ğŸ—ï¸ 2. ç³»ç»Ÿæ¨¡å—åŒ–é‡æ„

#### 2.1.1 åˆ†å±‚æ¶æ„å®ç°
**é‡æ„è®¡åˆ’ï¼š**
```
src/
â”œâ”€â”€ core/                    # æ ¸å¿ƒå±‚
â”‚   â”œâ”€â”€ main_controller.py   # ä¸»æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ retry_manager.py     # é‡è¯•ç®¡ç†
â”‚   â””â”€â”€ exception_handler.py # å¼‚å¸¸å¤„ç†
â”œâ”€â”€ data/                    # æ•°æ®å±‚
â”‚   â”œâ”€â”€ collectors/          # æ•°æ®æ”¶é›†å™¨
â”‚   â”œâ”€â”€ storage/            # æ•°æ®å­˜å‚¨
â”‚   â””â”€â”€ rag/                # RAGçŸ¥è¯†åº“
â”œâ”€â”€ ai/                      # AIå†³ç­–å±‚
â”‚   â”œâ”€â”€ models/             # æ¨¡å‹ç®¡ç†
â”‚   â”œâ”€â”€ fusion/             # å†³ç­–èåˆ
â”‚   â””â”€â”€ interfaces/         # æ¨¡å‹æ¥å£
â”œâ”€â”€ trading/                 # äº¤æ˜“æ‰§è¡Œå±‚
â”‚   â”œâ”€â”€ engine/             # äº¤æ˜“å¼•æ“
â”‚   â”œâ”€â”€ risk/               # é£é™©ç®¡ç†
â”‚   â””â”€â”€ position/           # ä»“ä½ç®¡ç†
â””â”€â”€ infrastructure/          # åŸºç¡€è®¾æ–½å±‚
    â”œâ”€â”€ config/             # é…ç½®ç®¡ç†
    â”œâ”€â”€ monitoring/         # ç›‘æ§å‘Šè­¦
    â””â”€â”€ logging/            # æ—¥å¿—ç³»ç»Ÿ
```
é€æ­¥å®ç°ï¼Œä¸è¦æ”¹åŠ¨åŸæœ‰å•å…ƒçš„é€»è¾‘ï¼Œä»…ä»…æ˜¯å¢åŠ æ¨¡å—é¢„ç•™ä½ç½®ï¼ˆå¯¹ï¼Œç›®å‰ä½ ä¸éœ€è¦å®Œæˆæ–°å¢çš„åŠŸèƒ½ï¼‰ï¼Œå¢åŠ å¯æ‰©å±•æ€§ï¼Œå¢åŠ å¯ç»´æŠ¤æ€§ï¼Œæ¯ä¸ªå•å…ƒçš„é…ç½®éƒ½å¿…é¡»ä½¿ç”¨config.jsonæ–‡ä»¶ï¼Œä¸è¦ä½¿ç”¨ç¯å¢ƒå˜é‡ã€‚å°½é‡ä¸è¦æ”¹åŠ¨configï¼Œæ–°å¢çš„åŠŸèƒ½ç•™å‡ºä½ç½®ï¼Œä¸è¦æ”¹åŠ¨åŸæœ‰å•å…ƒçš„é€»è¾‘ã€‚
#### 2.1.2é€æ­¥å®ç°éƒ¨åˆ†å®¹æ˜“å®ç°çš„åŠŸèƒ½ï¼Œå®ç°coreï¼Œdataï¼ˆæš‚æ—¶ä¸å¢åŠ RAGåŠŸèƒ½ï¼Œé¢„ç•™ä½ç½®ï¼‰ï¼Œaiï¼ˆä»…ä»…ä½¿ç”¨å†³ç­–è€…è¿™ä¸€ä¸ªaiï¼Œæš‚æ—¶ä¸å¯ç”¨å…¶ä»–ï¼‰ï¼Œtradingï¼ˆè¯·ä½ ä»”ç»†é˜…è¯»okxçš„apiæ–‡æ¡£ï¼‰ï¼Œinfrastructureï¼ˆæš‚æ—¶ä¸å¢åŠ ç›‘æ§å‘Šè­¦ï¼Œæ—¥å¿—ç³»ç»Ÿï¼Œé…ç½®ç®¡ç†ï¼‰

### ğŸ“š 3. RAGçŸ¥è¯†åº“ç³»ç»Ÿ

#### 3.1 çŸ¥è¯†åº“æ¶æ„è®¾è®¡
**ç»„ä»¶æ¸…å•ï¼š**
- **å¸‚åœºçŸ¥è¯†åº“**ï¼šå†å²è¡Œæƒ…æ•°æ®ã€å¸‚åœºäº‹ä»¶
- **äº¤æ˜“ç­–ç•¥åº“**ï¼šæˆåŠŸæ¡ˆä¾‹ã€å¤±è´¥æ¡ˆä¾‹
- **é£é™©æ¡ˆä¾‹åº“**ï¼šé£é™©äº‹ä»¶ã€åº”å¯¹ç­–ç•¥
- **å‘é‡æ£€ç´¢å¼•æ“**ï¼šæ”¯æŒè¯­ä¹‰æœç´¢

#### 3.2 æŠ€æœ¯å®ç°æ–¹æ¡ˆ
**æŠ€æœ¯æ ˆé€‰æ‹©ï¼š**
- **å‘é‡æ•°æ®åº“**ï¼šChroma / Weaviate / Qdrant
- **åµŒå…¥æ¨¡å‹**ï¼šGemini2.5-flash-preview-05-20
- **æ–‡æ¡£å¤„ç†**ï¼šLangChain / LlamaIndex

**å®æ–½æ­¥éª¤ï¼š**
- [ ] æ­å»ºå‘é‡æ•°æ®åº“ç¯å¢ƒ
- [ ] å®ç°æ–‡æ¡£åˆ‡åˆ†å’Œå‘é‡åŒ–
- [ ] å¼€å‘æ£€ç´¢æ¥å£
- [ ] é›†æˆåˆ°AIå†³ç­–æµç¨‹

**ä¼˜å…ˆçº§ï¼š** ğŸŸ¢ ä¸­é«˜
**é¢„ä¼°å·¥æœŸï¼š** 7-10å¤©

### ğŸ¤– 4. åˆ¤åˆ«æ¨¡å‹æ¥å£ç³»ç»Ÿ

#### 4.1 æ¨¡å‹æ¥å£è®¾è®¡
**æ¥å£è§„èŒƒï¼š**
```python
class DiscriminativeModelInterface:
    def predict(self, features: Dict) -> Dict:
        """é¢„æµ‹æ¥å£"""
        pass
    
    def get_confidence(self) -> float:
        """ç½®ä¿¡åº¦è·å–"""
        pass
    
    def get_feature_importance(self) -> Dict:
        """ç‰¹å¾é‡è¦æ€§"""
        pass
```

#### 4.2 å› å­ç®¡ç†ç³»ç»Ÿ
**å®æ–½è®¡åˆ’ï¼š**
- [ ] åˆ›å»º `src/ai/factors/` ç›®å½•
- [ ] å®ç°å› å­æ ‡å‡†åŒ–å™¨
- [ ] å¼€å‘å› å­æƒé‡ç®¡ç†
- [ ] é›†æˆæ¨¡å‹ç»“æœèåˆå™¨

**æŠ€æœ¯ç‰¹ç‚¹ï¼š**
- æ”¯æŒå¤šç§æ¨¡å‹ç±»å‹ï¼ˆæ ‘æ¨¡å‹ã€æ·±åº¦å­¦ä¹ ã€ä¼ ç»ŸMLï¼‰
- è‡ªåŠ¨ç‰¹å¾æ ‡å‡†åŒ–å’Œå½’ä¸€åŒ–
- åŠ¨æ€æƒé‡è°ƒæ•´æœºåˆ¶
- æ¨¡å‹æ€§èƒ½ç›‘æ§

**ä¼˜å…ˆçº§ï¼š** ğŸŸ¡ ä¸­
**é¢„ä¼°å·¥æœŸï¼š** 8-12å¤©

### ğŸ“Š 5. ç›‘æ§å’Œå¯æ‰©å±•æ€§å¢å¼º

#### 5.1 ç›‘æ§å‘Šè­¦ç³»ç»Ÿ
**åŠŸèƒ½è§„åˆ’ï¼š**
- [ ] ç³»ç»Ÿæ€§èƒ½ç›‘æ§ï¼ˆCPUã€å†…å­˜ã€ç½‘ç»œï¼‰
- [ ] äº¤æ˜“å¼‚å¸¸ç›‘æ§ï¼ˆå»¶è¿Ÿã€å¤±è´¥ç‡ï¼‰
- [ ] AIæ¨¡å‹ç›‘æ§ï¼ˆå‡†ç¡®ç‡ã€å“åº”æ—¶é—´ï¼‰
- [ ] å®æ—¶å‘Šè­¦é€šé“ï¼ˆé‚®ä»¶ã€é’‰é’‰ã€ä¼å¾®ï¼‰

#### 5.2 é…ç½®ç®¡ç†ä¸­å¿ƒ
**æ”¹è¿›å†…å®¹ï¼š**
- [ ] ç¯å¢ƒéš”ç¦»ï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰
- [ ] åŠ¨æ€é…ç½®çƒ­æ›´æ–°
- [ ] é…ç½®ç‰ˆæœ¬æ§åˆ¶
- [ ] æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨

**ä¼˜å…ˆçº§ï¼š** ğŸŸ¢ ä¸­é«˜
**é¢„ä¼°å·¥æœŸï¼š** 5-8å¤©

---

## ğŸš€ å®æ–½ä¼˜å…ˆçº§å’Œæ—¶é—´çº¿

### Phase 0: ç´§æ€¥é—®é¢˜ä¿®å¤ï¼ˆ1-2å¤©ï¼‰
1. ğŸ”´ Chromeå¯åŠ¨é—®é¢˜ä¿®å¤
2. ğŸ”´ æ•°æ®æœåŠ¡å™¨ç¨³å®šæ€§å¢å¼º
3. ğŸ”´ ç³»ç»Ÿå¯åŠ¨æµç¨‹ä¼˜åŒ–

### Phase 1: åŸºç¡€ç¨³å®šæ€§ï¼ˆ2-3å‘¨ï¼‰
1. âœ… å…¨é¢é‡è¯•æœºåˆ¶å®ç°
2. âœ… é‚®ä»¶é€šçŸ¥ç³»ç»Ÿ
3. âœ… å¼‚å¸¸å¤„ç†ä¼˜åŒ–
4. âœ… æ—¥å¿—ç³»ç»Ÿå®Œå–„

### Phase 2: æ¶æ„é‡æ„ï¼ˆ3-4å‘¨ï¼‰
1. âœ… åˆ†å±‚æ¶æ„å®ç°
2. âœ… æ¨¡å—åŒ–æ‹†åˆ†
4. âœ… é…ç½®ç®¡ç†å‡çº§

### Phase 3: æ™ºèƒ½åŒ–å¢å¼ºï¼ˆ2-3å‘¨ï¼‰
1. âœ… RAGçŸ¥è¯†åº“æ­å»º
2. âœ… åˆ¤åˆ«æ¨¡å‹æ¥å£
3. âœ… å†³ç­–èåˆå™¨
4. âœ… æ€§èƒ½ä¼˜åŒ–

### Phase 4: ç›‘æ§å’Œè¿ç»´ï¼ˆ1-2å‘¨ï¼‰
1. âœ… ç›‘æ§å‘Šè­¦ç³»ç»Ÿ
2. âœ… æ€§èƒ½åˆ†æå·¥å…·
3. âœ… è¿ç»´è‡ªåŠ¨åŒ–
4. âœ… æ–‡æ¡£å®Œå–„

---

## ğŸ’¡ æŠ€æœ¯é£é™©è¯„ä¼°

### ğŸ”´ é«˜é£é™©é¡¹
- **Chromeå¯åŠ¨å¤±è´¥**ï¼šå½“å‰ç³»ç»Ÿå­˜åœ¨Chromeæ— å¤´æµè§ˆå™¨å¯åŠ¨è¶…æ—¶é—®é¢˜ï¼ˆå·²å‘ç°ï¼‰
- **æ•°æ®æœåŠ¡å™¨ç¨³å®šæ€§**ï¼š`data_server.py`å¯åŠ¨å¼‚å¸¸ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿæ— æ³•è¿è¡Œ
- **RAGç³»ç»Ÿæ€§èƒ½**ï¼šå¤§é‡å†å²æ•°æ®æ£€ç´¢å¯èƒ½å½±å“å“åº”é€Ÿåº¦
- **å¤šæ¨¡å‹èåˆ**ï¼šä¸åŒæ¨¡å‹ç»“æœå¯èƒ½å­˜åœ¨å†²çª
- **ç³»ç»Ÿå¤æ‚åº¦**ï¼šè¿‡åº¦è®¾è®¡å¯èƒ½å½±å“ç¨³å®šæ€§

### ğŸŸ¡ ä¸­é£é™©é¡¹
- **APIé™åˆ¶**ï¼šGemini APIè°ƒç”¨é¢‘ç‡é™åˆ¶
- **æ•°æ®ä¸€è‡´æ€§**ï¼šå¤šæ•°æ®æºåŒæ­¥é—®é¢˜
- **å†…å­˜å ç”¨**ï¼šå‘é‡æ•°æ®åº“å†…å­˜æ¶ˆè€—

### ğŸŸ¢ ä½é£é™©é¡¹
- **é‡è¯•æœºåˆ¶**ï¼šæˆç†Ÿçš„è®¾è®¡æ¨¡å¼
- **é‚®ä»¶é€šçŸ¥**ï¼šæ ‡å‡†åŠŸèƒ½å®ç°
- **ç›‘æ§ç³»ç»Ÿ**ï¼šç°æœ‰å·¥å…·é›†æˆ

---

---
</prompt>

---

## ğŸ“ V2.0 æ¶æ„é‡æ„è¯¦ç»†å®æ–½è®¡åˆ’

**å…ƒæŒ‡ä»¤ï¼š** è¿™æ˜¯ä¸€ä¸ªä¸ºAIåˆ¶å®šçš„è¯¦ç»†ä»»åŠ¡æ¸…å•ã€‚å¿…é¡»ä¸¥æ ¼æŒ‰ç…§æ­¥éª¤é¡ºåºæ‰§è¡Œï¼Œä¸å¾—é—æ¼ã€‚ç›®æ ‡æ˜¯é‡æ„ç°æœ‰é¡¹ç›®ç»“æ„ï¼Œä½¿å…¶æ¨¡å—åŒ–ã€å¯ç»´æŠ¤ï¼ŒåŒæ—¶ä¸ºæœªæ¥åŠŸèƒ½é¢„ç•™æ¥å£ï¼Œä½†ä¸å®ç°å¤æ‚çš„æ–°åŠŸèƒ½ã€‚æ‰€æœ‰è·¯å¾„å’Œé…ç½®å¿…é¡»æ ‡å‡†åŒ–ã€‚

---

### **é˜¶æ®µä¸€ï¼šé¡¹ç›®ç»“æ„åˆå§‹åŒ– (Project Scaffolding)**

**ç›®æ ‡ï¼š** åˆ›å»ºæ–°çš„åˆ†å±‚ç›®å½•ç»“æ„ï¼Œå¹¶å°†ç°æœ‰æ–‡ä»¶ç§»åŠ¨åˆ°æ–°ä½ç½®ã€‚

1.  **[ ] åˆ›å»ºæ ¸å¿ƒç›®å½•ç»“æ„:**
    åœ¨ `src/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„åˆ†å±‚ç»“æ„ã€‚
    ```bash
    mkdir -p src/core
    mkdir -p src/ai/models src/ai/interfaces src/ai/fusion
    mkdir -p src/data/collectors src/data/storage src/data/rag
    mkdir -p src/trading/engine src/trading/api src/trading/risk src/trading/position
    mkdir -p src/infrastructure/web src/infrastructure/monitoring src/infrastructure/logging src/infrastructure/config
    ```

2.  **[ ] åˆå§‹åŒ–PythonåŒ…:**
    åœ¨æ‰€æœ‰æ–°å»ºçš„å­ç›®å½•ä¸­åˆ›å»ºç©ºçš„ `__init__.py` æ–‡ä»¶ï¼Œä½¿å…¶æˆä¸ºå¯å¯¼å…¥çš„PythonåŒ…ã€‚
    ```bash
    touch src/core/__init__.py
    touch src/ai/__init__.py src/ai/models/__init__.py src/ai/interfaces/__init__.py src/ai/fusion/__init__.py
    touch src/data/__init__.py src/data/collectors/__init__.py src/data/storage/__init__.py src/data/rag/__init__.py
    touch src/trading/__init__.py src/trading/engine/__init__.py src/trading/api/__init__.py src/trading/risk/__init__.py src/trading/position/__init__.py
    touch src/infrastructure/__init__.py src/infrastructure/web/__init__.py src/infrastructure/monitoring/__init__.py src/infrastructure/logging/__init__.py src/infrastructure/config/__init__.py
    ```

3.  **[ ] è¿ç§»æ–‡ä»¶åˆ°æ–°ä½ç½®:**
    ä½¿ç”¨ `mv` å‘½ä»¤å°†ç°æœ‰æ–‡ä»¶ç§»åŠ¨åˆ°æ–°çš„ç›®å½•ç»“æ„ä¸­ã€‚

    *   **æ ¸å¿ƒé€»è¾‘è¿ç§»:**
        ```bash
        mv src/main.py src/core/main_controller.py
        # åˆ›å»ºä¸€ä¸ªæ–°çš„å…¥å£æ–‡ä»¶
        touch src/main.py 
        ```
    *   **æ•°æ®é€»è¾‘è¿ç§»:**
        ```bash
        mv src/main_get.py src/data/collector_service.py
        mv src/get_data/technical_indicator_collector.py src/data/collectors/
        mv src/get_data/macro_factor_collector.py src/data/collectors/
        mv src/get_data/get_positions.py src/data/collectors/
        mv src/get_data/tradingview_auto_screenshot.py src/data/collectors/
        rm -rf src/get_data # åˆ é™¤æ—§ç›®å½•
        ```
    *   **AIæ¨¡å‹è¿ç§»:**
        ```bash
        mv src/MES/gemini_Controller.py src/ai/models/gemini_controller.py
        mv src/MES/gemini_Critic.py src/ai/models/gemini_critic.py
        rm -rf src/MES # åˆ é™¤æ—§ç›®å½•
        ```
    *   **äº¤æ˜“é€»è¾‘è¿ç§»:**
        ```bash
        mv src/auto_trader.py src/trading/engine/auto_trader.py
        mv function/trade/place_order.py src/trading/api/
        mv function/trade/trade_history.py src/trading/api/
        # æ¸…ç†functionç›®å½•ä¸­å·²ç§»åŠ¨çš„æ¨¡å—
        rm -rf function/trade 
        ```
    *   **åŸºç¡€è®¾æ–½è¿ç§»:**
        ```bash
        mv src/data_server.py src/infrastructure/web/data_server.py
        ```
    *   **å‰©ä½™å·¥å…·å‡½æ•°è¿ç§»:**
        ```bash
        mv function/kline_pattern_analyzer.py src/data/analysis/
        mv function/get_transaction_history.py src/trading/api/
        # åˆ›å»ºæ–°ç›®å½•
        mkdir -p src/data/analysis
        touch src/data/analysis/__init__.py
        rm -rf function # åˆ é™¤æ—§ç›®å½•
        ```

### **é˜¶æ®µäºŒï¼šä»£ç è¿ç§»ä¸é€‚é… (Code Migration & Adaptation)**

**ç›®æ ‡ï¼š** ä¿®æ­£æ‰€æœ‰å› æ–‡ä»¶ç§»åŠ¨å¯¼è‡´çš„å¯¼å…¥é”™è¯¯å’Œè·¯å¾„é—®é¢˜ï¼Œç¡®ä¿ä»£ç å¯è¿è¡Œã€‚

1.  **[ ] æ›´æ–°é¡¹ç›®å…¥å£ `src/main.py`:**
    å†™å…¥æ–°çš„å¯åŠ¨é€»è¾‘ï¼Œè°ƒç”¨é‡æ„åçš„ä¸»æ§åˆ¶å™¨ã€‚
    ```python
    # src/main.py
    import sys
    import os

    # ç¡®ä¿é¡¹ç›®æ ¹ç›®å½•åœ¨sys.pathä¸­ï¼Œä»¥ä¾¿è¿›è¡Œç»å¯¹å¯¼å…¥
    sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))

    from src.core.main_controller import main

    if __name__ == "__main__":
        main()
    ```

2.  **[ ] é€‚é…æ ¸å¿ƒæ§åˆ¶å™¨ `src/core/main_controller.py`:**
    *   **ä¿®æ­£å¯¼å…¥è¯­å¥:**
        ```python
        # old: from src.main_get import main as get_main
        # new:
        from src.data.collector_service import main as get_main
        
        # old: from src.auto_trader import main as auto_trade_main
        # new:
        from src.trading.engine.auto_trader import main as auto_trade_main
        ```
    *   **ä¿®æ­£é‡å¯æ•°æ®æœåŠ¡å™¨çš„è·¯å¾„:**
        ```python
        # old: subprocess.run(['pkill', '-f', 'src/data_server.py'], check=False)
        # new:
        subprocess.run(['pkill', '-f', 'src/infrastructure/web/data_server.py'], check=False)

        # old: server_process = subprocess.Popen(['uv', 'run', '--python', '3.11', 'src/data_server.py'])
        # new:
        server_process = subprocess.Popen(['uv', 'run', '--python', '3.11', 'src/infrastructure/web/data_server.py'])
        ```
    *   **ä¿®æ­£Gemini APIè°ƒç”¨è„šæœ¬çš„è·¯å¾„:**
        ```python
        # old: result = subprocess.run(['uv', 'run', 'src/MES/gemini_Controller.py'], check=True)
        # new:
        result = subprocess.run(['uv', 'run', 'src/ai/models/gemini_controller.py'], check=True)
        ```

3.  **[ ] é€‚é…æ•°æ®æ”¶é›†æœåŠ¡ `src/data/collector_service.py`:**
    *   **ä¿®æ­£å¯¼å…¥è¯­å¥:**
        ```python
        # old: from function.kline_pattern_analyzer import analyze_kline_patterns
        # new:
        from src.data.analysis.kline_pattern_analyzer import analyze_kline_patterns

        # old: from get_data.technical_indicator_collector import collect_technical_indicators
        # new:
        from src.data.collectors.technical_indicator_collector import collect_technical_indicators

        # old: from get_data.macro_factor_collector import collect_macro_factors
        # new:
        from src.data.collectors.macro_factor_collector import collect_macro_factors

        # old: from get_data.get_positions import collect_positions_data
        # new:
        from src.data.collectors.get_positions import collect_positions_data
        ```

4.  **[ ] é€‚é…AIæ¨¡å‹ `src/ai/models/gemini_controller.py`:**
    *   **ä¿®æ­£å¯¼å…¥è¯­å¥å’Œè·¯å¾„å¤„ç†:**
        ```python
        # ç§»é™¤æ—§çš„ã€å¤æ‚çš„sys.pathæ“ä½œ
        # sys.path.insert(0, FUNCTION_DIR)
        
        # old: from kline_pattern_analyzer import analyze_kline_patterns
        # new:
        from src.data.analysis.kline_pattern_analyzer import analyze_kline_patterns

        # old: import get_transaction_history
        # new:
        from src.trading.api import get_transaction_history
        ```
    *   **æ ‡å‡†åŒ–é…ç½®æ–‡ä»¶è·¯å¾„:** ç¡®ä¿æ‰€æœ‰ `open("config/...")` éƒ½æ˜¯ä»é¡¹ç›®æ ¹ç›®å½•å‡ºå‘çš„ç›¸å¯¹è·¯å¾„ã€‚

5.  **[ ] é€‚é…äº¤æ˜“å¼•æ“ `src/trading/engine/auto_trader.py`:**
    *   **ä¿®æ­£å¯¼å…¥è¯­å¥:**
        ```python
        # old: from function.trade.place_order import (...)
        # new:
        from src.trading.api.place_order import (
            place_order,
            close_position,
            cancel_all_pending_orders,
            get_current_position,
            get_order_all
        )

        # old: from function.trade.trade_history import TradeHistory
        # new:
        from src.trading.api.trade_history import TradeHistory
        ```

6.  **[ ] å…¨å±€å®¡æŸ¥å’Œä¿®æ­£:**
    *   **å®¡æŸ¥æ‰€æœ‰æ–‡ä»¶**ï¼šæ£€æŸ¥æ˜¯å¦æœ‰é—æ¼çš„ `sys.path` æ“ä½œæˆ–ç¡¬ç¼–ç çš„ç›¸å¯¹è·¯å¾„ `../`ã€‚
    *   **ç»Ÿä¸€é…ç½®åŠ è½½**ï¼šç¡®ä¿æ‰€æœ‰æ¨¡å—éƒ½ä»åŒä¸€ä¸ª `config.json` å®ä¾‹æˆ–æ ‡å‡†åŒ–çš„åŠ è½½å‡½æ•°ä¸­è·å–é…ç½®ï¼Œé¿å…é‡å¤åŠ è½½ã€‚
    *   **éªŒè¯ `pyproject.toml`**ï¼šç¡®ä¿ `[tool.setuptools.packages.find]` é…ç½®ä¸æ–°çš„ `src` ç›®å½•ç»“æ„åŒ¹é…ã€‚

### **é˜¶æ®µä¸‰ï¼šåŠŸèƒ½å®ç°ä¸é›†æˆ (Feature Implementation & Integration)**

**ç›®æ ‡ï¼š** å®ç°`todo.md`ä¸­è¦æ±‚çš„éƒ¨åˆ†ç®€å•åŠŸèƒ½ï¼Œå¹¶ä¸ºæœªæ¥åŠŸèƒ½é¢„ç•™æ¥å£ã€‚

1.  **[ ] å®ç° `core` æ¨¡å—:**
    *   **åˆ›å»º `src/core/retry_manager.py`:**
        ```python
        # src/core/retry_manager.py
        import time
        import logging

        logger = logging.getLogger("GeminiQuant")

        def retry(max_tries=3, delay_seconds=1, backoff=2):
            # ... å®ç°è£…é¥°å™¨ ...
            pass
        ```
    *   **åˆ›å»º `src/core/exception_handler.py`:**
        ```python
        # src/core/exception_handler.py
        import logging
        logger = logging.getLogger("GeminiQuant")

        def handle_exception(exc_type, exc_value, exc_traceback):
            # ... å®ç°å…¨å±€å¼‚å¸¸æ•è·é€»è¾‘ ...
            pass
        ```
    *   **é›†æˆåˆ° `main_controller.py`**: å°†é‡è¯•é€»è¾‘åº”ç”¨åˆ°å…³é”®çš„ç½‘ç»œè°ƒç”¨å’Œå­è¿›ç¨‹æ‰§è¡Œä¸Šã€‚

2.  **[ ] é¢„ç•™ `data` æ¨¡å—æ¥å£:**
    *   **åˆ›å»º `src/data/rag/retriever.py` (ç©ºæ–‡ä»¶):** é¢„ç•™RAGçŸ¥è¯†åº“æ£€ç´¢å™¨ä½ç½®ã€‚
    *   **åœ¨ `config.json` ä¸­æ·»åŠ RAGé…ç½®èŠ‚ï¼ˆæ³¨é‡Šæ‰ï¼‰:**
        ```json
        // "rag_config": {
        //     "vector_db_path": "data/storage/vector_db",
        //     "embedding_model": "gemini-2.5-flash-preview-05-20"
        // }
        ```

3.  **[ ] è°ƒæ•´ `ai` æ¨¡å—:**
    *   **ä¿®æ”¹ `main_controller.py`**: ç¡®ä¿åªè°ƒç”¨ `gemini_controller.py`ã€‚
    *   **æ³¨é‡Šæ‰ `gemini_critic.py` çš„è°ƒç”¨**: åœ¨ä¸»æµç¨‹ä¸­æš‚æ—¶ç¦ç”¨Criticæ¨¡å‹ã€‚

4.  **[ ] å®Œå–„ `trading` æ¨¡å—:**
    *   **APIæ–‡æ¡£å­¦ä¹ **: (è¿™æ˜¯ä¸€ä¸ªå…ƒä»»åŠ¡) åœ¨å®ç°å‰ï¼Œå¿…é¡»ä»”ç»†é˜…è¯»OKX V5 APIæ–‡æ¡£ï¼Œç‰¹åˆ«æ˜¯å…³äºä¸‹å•ï¼ˆ`POST /api/v5/trade/order`ï¼‰ã€æ­¢ç›ˆæ­¢æŸã€æ’¤å•ç­‰æ¥å£çš„ç»†èŠ‚ã€‚
    *   **å‚æ•°æ ¡éªŒ**: åœ¨ `src/trading/api/place_order.py` ä¸­ï¼Œä¸º `place_order` å‡½æ•°å¢åŠ ä¸¥æ ¼çš„å‚æ•°æ ¡éªŒé€»è¾‘ï¼Œç¡®ä¿`side`, `posSide`, `ordType` ç­‰ç¬¦åˆAPIè¦æ±‚ã€‚
    *   **é”™è¯¯å¤„ç†**: å°è£…OKX APIçš„è¿”å›ç»“æœï¼Œå¯¹ `code != "0"` çš„æƒ…å†µè¿›è¡Œè¯¦ç»†çš„æ—¥å¿—è®°å½•å’Œå¼‚å¸¸æŠ›å‡ºã€‚

5.  **[ ] é¢„ç•™ `infrastructure` æ¨¡å—æ¥å£:**
    *   **åˆ›å»º `src/infrastructure/monitoring/monitor.py` (ç©ºæ–‡ä»¶):** é¢„ç•™ç›‘æ§é€»è¾‘ã€‚
    *   **åˆ›å»º `src/infrastructure/logging/log_manager.py` (ç©ºæ–‡ä»¶):** é¢„ç•™ç»Ÿä¸€æ—¥å¿—ç®¡ç†å™¨ã€‚
    *   **åœ¨ `config.json` ä¸­æ·»åŠ ç›¸å…³é…ç½®èŠ‚ï¼ˆæ³¨é‡Šæ‰ï¼‰:**
        ```json
        // "monitoring": {
        //     "enable": false,
        //     "alert_webhook": ""
        // }
        ```

### **é˜¶æ®µå››ï¼šæµ‹è¯•ä¸éªŒè¯ (Testing & Validation)**

**ç›®æ ‡ï¼š** ç¡®ä¿é‡æ„åçš„ç³»ç»Ÿèƒ½å¤Ÿæ— é”™è¯¯åœ°è¿è¡Œï¼Œå¹¶ä¸”é€»è¾‘ä¸é‡æ„å‰ä¿æŒä¸€è‡´ã€‚

1.  **[ ] å•å…ƒæµ‹è¯• (æ¨¡æ‹Ÿè¿è¡Œ):**
    *   é’ˆå¯¹æ¯ä¸ªè¢«ç§»åŠ¨çš„æ¨¡å—ï¼Œç¼–å†™ä¸€ä¸ªç®€å•çš„æµ‹è¯•è„šæœ¬ï¼Œåªæµ‹è¯•æ¨¡å—æ˜¯å¦èƒ½è¢«æˆåŠŸå¯¼å…¥ã€‚
    *   é‡ç‚¹æµ‹è¯• `main_controller.py`ï¼Œæ¨¡æ‹Ÿå…¶æ‰€æœ‰å­æ¨¡å—è°ƒç”¨ï¼Œç¡®ä¿è°ƒç”¨é“¾æ­£ç¡®ã€‚

2.  **[ ] é›†æˆæµ‹è¯• (å®Œæ•´æµç¨‹):**
    *   æ‰§è¡Œä¸€æ¬¡å®Œæ•´çš„ç«¯åˆ°ç«¯æµç¨‹ï¼š`uv run src/main.py`ã€‚
    *   **ç›‘æ§æ—¥å¿—è¾“å‡º**ï¼šä»”ç»†è§‚å¯Ÿæ¯ä¸ªæ¨¡å—çš„æ—¥å¿—ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰è·¯å¾„é”™è¯¯ã€å¯¼å…¥å¤±è´¥æˆ–é…ç½®åŠ è½½é—®é¢˜ã€‚
    *   **éªŒè¯è¾“å‡ºæ–‡ä»¶**ï¼šæ£€æŸ¥ `data/data.json` å’Œ `data/Controller_answer.json` æ˜¯å¦èƒ½è¢«æ­£ç¡®ç”Ÿæˆã€‚
    *   **æ¨¡æ‹Ÿäº¤æ˜“**ï¼šåœ¨OKXçš„æ¨¡æ‹Ÿç›˜ï¼ˆ`flag="0"`ï¼‰ç¯å¢ƒä¸­è¿è¡Œäº¤æ˜“æµç¨‹ï¼ŒéªŒè¯è®¢å•èƒ½å¦æ­£ç¡®åˆ›å»ºå’Œç®¡ç†ã€‚

3.  **[ ] è§£å†³é—ç•™é—®é¢˜:**
    *   **ä¿®å¤`data_server.py`å¯åŠ¨é—®é¢˜**: åº”ç”¨åœ¨`todo.md`ä¸­åˆ¶å®šçš„ç´§æ€¥ä¿®å¤æ–¹æ¡ˆï¼Œä¸ºChromeå¯åŠ¨æ·»åŠ è¶…æ—¶å’Œé‡è¯•ã€‚
    *   æ ¹æ®æµ‹è¯•ä¸­å‘ç°çš„ä»»ä½•bugï¼Œè¿”å›é˜¶æ®µäºŒå’Œé˜¶æ®µä¸‰è¿›è¡Œä¿®æ­£ã€‚

---
*ç‰ˆæœ¬ï¼šv2.1 é‡æ„å®æ–½è®¡åˆ’*