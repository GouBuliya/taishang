# TaiShang - AIé©±åŠ¨çš„åŠ å¯†è´§å¸é‡åŒ–äº¤æ˜“ç³»ç»Ÿ

TaiShangæ˜¯ä¸€ä¸ªåŸºäºŽGoogle Gemini AIçš„è‡ªåŠ¨åŒ–åŠ å¯†è´§å¸äº¤æ˜“ç³»ç»Ÿï¼Œä¸“é—¨è®¾è®¡ç”¨äºŽOKXäº¤æ˜“æ‰€çš„äº¤æ˜“ã€‚ç³»ç»Ÿç»“åˆäº†æŠ€æœ¯åˆ†æžã€å¸‚åœºæ•°æ®å’ŒAIå†³ç­–æ”¯æŒï¼Œæä¾›æ™ºèƒ½åŒ–çš„äº¤æ˜“æ‰§è¡ŒæœåŠ¡ã€‚

## ä¸»è¦ç‰¹æ€§

- ðŸ¤– AIé©±åŠ¨çš„äº¤æ˜“å†³ç­–ï¼ˆåŸºäºŽGoogle Geminiï¼‰
- ðŸ“Š è‡ªåŠ¨åŒ–æŠ€æœ¯åˆ†æžå’Œå¸‚åœºæ•°æ®æ”¶é›†
- ðŸ“ˆ å®žæ—¶Kçº¿æ¨¡å¼è¯†åˆ«å’Œè¶‹åŠ¿åˆ†æž
- ðŸ’¹ è‡ªåŠ¨åŒ–äº¤æ˜“æ‰§è¡Œï¼ˆå¼€ä»“/å¹³ä»“ï¼‰
- âš¡ å®žæ—¶å¸‚åœºç›‘æŽ§å’Œé£Žé™©æŽ§åˆ¶
- ðŸ“ è¯¦ç»†çš„äº¤æ˜“æ—¥å¿—å’Œåˆ†æžæŠ¥å‘Š

## ç³»ç»Ÿæž¶æž„

```mermaid
graph TD
    %% ç³»ç»Ÿå¯åŠ¨ä¸Žä¸»å¾ªçŽ¯
    A[ç³»ç»Ÿå¯åŠ¨] --> B[ä¸»å¾ªçŽ¯: æ¯30åˆ†é’Ÿæ‰§è¡Œ]
    
    %% åˆå§‹åŒ–æµç¨‹
    subgraph "åˆå§‹åŒ–æµç¨‹"
        A --> InitEnv[çŽ¯å¢ƒæ£€æŸ¥]
        InitEnv --> InitConfig[é…ç½®åŠ è½½ä¸ŽéªŒè¯]
        InitConfig --> InitAPI[APIå¯†é’¥éªŒè¯]
        InitAPI --> InitLog[æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–]
        InitLog --> InitService[æœåŠ¡å¯åŠ¨]
        InitService --> InitAI[AIæ¨¡åž‹åˆå§‹åŒ–]
    end

    %% æ•°æ®èŽ·å–æµç¨‹
    subgraph "æ•°æ®èŽ·å–"
        B --> C[æ•°æ®èŽ·å–é˜¶æ®µ]
        C --> C1[èŽ·å–æŒä»“ä¿¡æ¯]
        C --> C2[èŽ·å–å¸‚åœºæ•°æ®]
        C2 --> C3[åˆå§‹åŒ–æˆªå›¾é©±åŠ¨]
        C1 & C2 & C3 --> C4[æ•´åˆæ•°æ®]
    end

    %% æ•°æ®å¤„ç†æµç¨‹
    subgraph "æ•°æ®å¤„ç†"
        C4 --> D[æ•°æ®å¤„ç†é˜¶æ®µ]
        D --> D1[æ•°æ®åˆ†æžè¾“å…¥]
        D1 --> D2[ç‰¹å¾è®¡ç®—]
        D1 --> D3[ä¿¡æ¯é¢„å¤„ç†]
        D2 & D3 --> D4[åˆ†æžè¾“å‡º]
    end

    %% AIå†³ç­–æµç¨‹
    subgraph "AIå†³ç­–"
        D4 --> E[å†³ç­–æµç¨‹]
        E --> E1[ç­–ç•¥åˆ¶å®šï¼ˆå†³ç­–è€…ï¼‰]
        E1 --> E2[ç­–ç•¥å®¡æŸ¥ï¼ˆè°å®˜ï¼‰]
        E2 -->|é€šè¿‡| F[é£Žé™©ç®¡ç†ï¼ˆé£Žé™©ç®¡ç†å‘˜ï¼‰]
        E2 -->|ä¸é€šè¿‡| E1
    end

    %% äº¤æ˜“æ‰§è¡Œæµç¨‹
    subgraph "äº¤æ˜“æ‰§è¡Œ"
        F --> G[æ‰§è¡Œæµç¨‹]
        G --> G1[è®¢å•æ ¡éªŒ]
        G1 --> G2[äº¤æ˜“æ“ä½œ]
        G2 --> G3[æ—¥å¿—è®°å½•]
        G3 --> G4[ç»“æžœè®°å½•]
        G4 --> G5[çŠ¶æ€é€šçŸ¥]
    end

    %% å¤–éƒ¨ç³»ç»Ÿäº¤äº’
    G2 --> H[OKX APIè°ƒç”¨]
    H --> G3

    %% åé¦ˆå¾ªçŽ¯
    G5 --> B
    G3 --> I[åŽ†å²è®°å½•]
    I --> PerfEval[ç»©æ•ˆè¯„ä¼°ï¼ˆç»©æ•ˆè¯„ä¼°ä¸“å®¶ï¼‰]
    PerfEval --> E1
```
### æ ¸å¿ƒæ¨¡å—è¯´æ˜Ž

1. **ä¸»æŽ§æ¨¡å— (main.py)** - ç³»ç»Ÿå…¥å£ç‚¹ï¼Œåˆå§‹åŒ–å¹¶å¯åŠ¨å„å­ç³»ç»Ÿ
2. **æ ¸å¿ƒæŽ§åˆ¶å™¨ (main_controller.py)** - ç³»ç»Ÿä¸»æŽ§åˆ¶å™¨ï¼Œç®¡ç†è¿è¡Œæ¨¡å¼å’Œæ¨¡å—åè°ƒ
3. **æ•°æ®æ”¶é›†æœåŠ¡ (collector_service.py)** - æ•´åˆæŠ€æœ¯æŒ‡æ ‡ã€å®è§‚å› å­å’ŒæŒä»“æ•°æ®æ”¶é›†
4. **AIå†³ç­–æ¨¡å— (gemini_controller.py)** - åŸºäºŽGemini AIçš„äº¤æ˜“ç­–ç•¥ç”Ÿæˆç³»ç»Ÿ
5. **äº¤æ˜“æ‰§è¡Œå¼•æ“Ž (auto_trader.py)** - æ‰§è¡Œäº¤æ˜“æŒ‡ä»¤ã€ç®¡ç†è®¢å•å’Œé£Žé™©æŽ§åˆ¶
6. **Kçº¿æ¨¡å¼åˆ†æž** - è¯†åˆ«Kçº¿å½¢æ€å’Œè¶‹åŠ¿
7. **åŸºç¡€è®¾æ–½æœåŠ¡** - æä¾›WebæœåŠ¡ç­‰åŸºç¡€è®¾æ–½æ”¯æŒ

## å®‰è£…æŒ‡å—

1. å…‹éš†ä»“åº“
```bash
git clone [repository-url]
cd taishang
```

2. åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹ŸçŽ¯å¢ƒï¼ˆæŽ¨èï¼‰
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
```

3. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

4. é…ç½®ç³»ç»Ÿ
- å¤åˆ¶`config/config.json.example`åˆ°`config/config.json`
- å¡«å†™å¿…è¦çš„é…ç½®ä¿¡æ¯ï¼š
  * OKX APIå‡­è¯ï¼ˆapi_key, secret_key, passphraseï¼‰
  * Gemini APIå¯†é’¥ï¼ˆåœ¨MODEL_CONFIGéƒ¨åˆ†ï¼‰
  * ä»£ç†è®¾ç½®ï¼ˆå¦‚éœ€è¦ï¼‰
  * æ•°æ®æ–‡ä»¶è·¯å¾„é…ç½®
  * æ—¥å¿—æ–‡ä»¶è·¯å¾„é…ç½®

## ä½¿ç”¨æŒ‡å—

### å‘½ä»¤è¡Œé€‰é¡¹

æ‚¨å¯ä»¥é€šè¿‡ä¸°å¯Œçš„å‘½ä»¤è¡Œå‚æ•°æ¥æŽ§åˆ¶ç³»ç»Ÿçš„è¡Œä¸ºã€‚

| å‚æ•° (é•¿) | å‚æ•° (çŸ­) | æè¿° | é»˜è®¤å€¼/å¯é€‰å€¼ | ç¤ºä¾‹ç”¨æ³• |
| :--- | :--- | :--- | :--- | :--- |
| `--debug` | `-d` | **è°ƒè¯•æ¨¡å¼**ï¼šç«‹å³æ‰§è¡Œä¸€æ¬¡å®Œæ•´çš„äº¤æ˜“æµç¨‹ï¼ˆæ•°æ®é‡‡é›† -> AIå†³ç­– -> äº¤æ˜“æ‰§è¡Œï¼‰åŽé€€å‡ºã€‚ | - | `uv run src/core/main_controller.py --debug` |
| `--debug-loop` | | **è°ƒè¯•å¾ªçŽ¯æ¨¡å¼**ï¼šè¿žç»­æ‰§è¡Œäº¤æ˜“æµç¨‹ï¼Œè·³è¿‡æ¯ä¸ªå¾ªçŽ¯ä¹‹é—´çš„ç­‰å¾…æ—¶é—´ï¼Œç”¨äºŽå¿«é€Ÿè¿­ä»£æµ‹è¯•ã€‚ | - | `uv run src/core/main_controller.py --debug-loop` |
| `--dry-run` | | **æ¨¡æ‹Ÿè¿è¡Œæ¨¡å¼**ï¼šæ‰§è¡Œæ‰€æœ‰æ­¥éª¤ï¼Œä½†ä¸ä¼šå®žé™…ä¸‹å•äº¤æ˜“ã€‚æ‰€æœ‰äº¤æ˜“æŒ‡ä»¤å°†è¢«æ‰“å°åˆ°æ—¥å¿—ï¼Œç”¨äºŽå®‰å…¨æµ‹è¯•ç­–ç•¥ã€‚ | - | `uv run src/core/main_controller.py --dry-run` |
| `--think` | | **æ€è€ƒæ‘˜è¦æ¨¡å¼**ï¼šåœ¨AIå†³ç­–æ—¶ï¼Œå®žæ—¶æ‰“å°æ¨¡åž‹çš„æ€è€ƒè¿‡ç¨‹ï¼ˆç»¿è‰²ï¼‰å’Œæœ€ç»ˆè¾“å‡ºï¼ˆç±³è‰²ï¼‰ï¼Œç”¨äºŽæ·±å…¥è°ƒè¯•AIè¡Œä¸ºã€‚ | - | `uv run src/core/main_controller.py --think` |
| `--log-level` | | **æ—¥å¿—çº§åˆ«**ï¼šè®¾ç½®æ—¥å¿—è®°å½•çš„è¯¦ç»†ç¨‹åº¦ã€‚ | `INFO` (é»˜è®¤), `DEBUG`, `WARNING`, `ERROR` | `uv run src/core/main_controller.py --log-level DEBUG` |
| `--config` | | **æŒ‡å®šé…ç½®æ–‡ä»¶**ï¼šä½¿ç”¨è‡ªå®šä¹‰çš„ `config.json` æ–‡ä»¶è·¯å¾„ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„ `config.json`ã€‚ | `config.json` | `uv run src/core/main_controller.py --config /path/to/my_config.json` |
| `--skip-server` | | **è·³è¿‡æœåŠ¡å™¨å¯åŠ¨**ï¼šå‡è®¾æ•°æ®é‡‡é›†æœåŠ¡å·²åœ¨åŽå°è¿è¡Œï¼Œä¸»æŽ§åˆ¶å™¨å°†ä¸å†å°è¯•å¯åŠ¨å®ƒã€‚ | - | `uv run src/core/main_controller.py --skip-server` |
| `--help-debug` | | **æ˜¾ç¤ºè°ƒè¯•å¸®åŠ©**ï¼šæ‰“å°å…³äºŽä¸åŒè°ƒè¯•æ¨¡å¼å’Œå‚æ•°ç»„åˆçš„è¯¦ç»†è¯´æ˜Žã€‚ | - | `uv run src/core/main_controller.py --help-debug` |


### å¯åŠ¨ç³»ç»Ÿ

åŸºæœ¬å¯åŠ¨ï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰ï¼š
```bash
uv run src/core/main_controller.py
```

#### ç»„åˆç”¨æ³•ç¤ºä¾‹
```bash
# ä½¿ç”¨DEBUGæ—¥å¿—çº§åˆ«è¿›è¡Œä¸€æ¬¡æ¨¡æ‹Ÿè¿è¡Œï¼Œå¹¶æŸ¥çœ‹AIçš„è¯¦ç»†æ€è€ƒè¿‡ç¨‹
uv run src/core/main_controller.py --debug --dry-run --think --log-level DEBUG
```

#### æ—§ç‰ˆå¯åŠ¨æ–¹å¼ (å¦‚æžœé€‚ç”¨)
```bash
python src/main.py
```

### ç³»ç»Ÿæ¨¡å¼
- **ç”Ÿäº§æ¨¡å¼**ï¼šæ‰§è¡ŒçœŸå®žäº¤æ˜“ï¼ˆé»˜è®¤æ¨¡å¼ï¼‰ã€‚
- **æ¨¡æ‹Ÿè¿è¡Œæ¨¡å¼**ï¼šä¸æ‰§è¡ŒçœŸå®žäº¤æ˜“ï¼Œç”¨äºŽæµ‹è¯•ï¼ˆä½¿ç”¨`--dry-run`ï¼‰ã€‚
- **è°ƒè¯•æ¨¡å¼**ï¼šç”¨äºŽå¼€å‘å’Œå¿«é€Ÿæµ‹è¯•ï¼ˆä½¿ç”¨`--debug`æˆ–`--debug-loop`ï¼‰ã€‚

### ç›‘æŽ§äº¤æ˜“
- æŸ¥çœ‹ `logs/main.log` èŽ·å–ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ã€‚
- æŸ¥çœ‹ `logs/trade_history.json` èŽ·å–äº¤æ˜“åŽ†å²
- æŸ¥çœ‹ `logs/ai_decisions.md` èŽ·å–AIå†³ç­–è¿‡ç¨‹

## å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æž„
```
taishang/
â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶
â”œâ”€â”€ data/                   # æ•°æ®æ–‡ä»¶
â”œâ”€â”€ src/                    # æºä»£ç 
â”‚   â”œâ”€â”€ ai/                # AIç›¸å…³æ¨¡å—
â”‚   â”œâ”€â”€ core/              # æ ¸å¿ƒæŽ§åˆ¶é€»è¾‘
â”‚   â”œâ”€â”€ data/              # æ•°æ®æ”¶é›†æœåŠ¡
â”‚   â”œâ”€â”€ infrastructure/    # åŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ trading/           # äº¤æ˜“æ‰§è¡Œæ¨¡å—
â”‚   â””â”€â”€ main.py            # ç³»ç»Ÿå…¥å£
â”œâ”€â”€ logs/                  # æ—¥å¿—æ–‡ä»¶
â””â”€â”€ tests/                 # æµ‹è¯•ä»£ç 
```

## å®‰å…¨æç¤º

1. APIå¯†é’¥å®‰å…¨
- ä½¿ç”¨çŽ¯å¢ƒå˜é‡æˆ–åŠ å¯†é…ç½®æ–‡ä»¶å­˜å‚¨æ•æ„Ÿä¿¡æ¯
- è®¾ç½®æœ€å°å¿…è¦æƒé™çš„APIå¯†é’¥
- å®šæœŸæ›´æ¢APIå¯†é’¥

2. é£Žé™©æŽ§åˆ¶
- è®¾ç½®åˆç†çš„äº¤æ˜“é™é¢
- å¯ç”¨æ­¢æŸä¿æŠ¤
- å®šæœŸæ£€æŸ¥ç³»ç»Ÿæ—¥å¿—


```mermaid
graph TD
    A[AIå†³ç­–] --> B[è°å®˜å®¡æŸ¥]
    B --> C{å®¡æŸ¥ç»“æžœ}
    C -->|é€šè¿‡| D[æ‰§è¡Œäº¤æ˜“]
    C -->|å¤±è´¥| E[æå–è°å®˜åé¦ˆ]
    E --> F[ç”Ÿæˆå…·ä½“ä¿®æ­£æç¤ºè¯]
    F --> G[é‡æ–°å†³ç­–]
    D --> H{äº¤æ˜“ç»“æžœ}
    H -->|æˆåŠŸ| I[å®Œæˆ]
    H -->|å¤±è´¥| J[ç”Ÿæˆæ‰§è¡Œå¤±è´¥æç¤ºè¯]
    J --> G
    G --> A
```